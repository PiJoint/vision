\hypertarget{namespacesrc_1_1service}{}\doxysection{src.\+service Namespace Reference}
\label{namespacesrc_1_1service}\index{src.service@{src.service}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespacesrc_1_1service_a1b10c504335cd811f3ce4fa0c1e8bb3e}{ground\+\_\+position}} (img)
\begin{DoxyCompactList}\small\item\em Return the position of the block. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacesrc_1_1service_aa68d180e8a321d2d69439263842208a5}{pose}} (img, ob\+\_\+c, point\+\_\+cloud, box)
\begin{DoxyCompactList}\small\item\em Return the pose of the object. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{namespacesrc_1_1service_a79d5af0b742289ccbb131edb7c7d853c}\label{namespacesrc_1_1service_a79d5af0b742289ccbb131edb7c7d853c}} 
def \mbox{\hyperlink{namespacesrc_1_1service_a79d5af0b742289ccbb131edb7c7d853c}{object\+\_\+detection}} (req)
\begin{DoxyCompactList}\small\item\em Service callback. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{namespacesrc_1_1service_a79c55cc4a2fde20ac7b1cb1e5e5cd609}\label{namespacesrc_1_1service_a79c55cc4a2fde20ac7b1cb1e5e5cd609}} 
def \mbox{\hyperlink{namespacesrc_1_1service_a79c55cc4a2fde20ac7b1cb1e5e5cd609}{init}} ()
\begin{DoxyCompactList}\small\item\em Init function Load listner and services. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{namespacesrc_1_1service_afec80ca3b8e4ba0fdf37f1ae24fd523a}\label{namespacesrc_1_1service_afec80ca3b8e4ba0fdf37f1ae24fd523a}} 
\mbox{\hyperlink{namespacesrc_1_1service_afec80ca3b8e4ba0fdf37f1ae24fd523a}{bridge}} = Cv\+Bridge()
\begin{DoxyCompactList}\small\item\em Cv\+Bridge object. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{namespacesrc_1_1service_aeb636e4930c1fbe30610e2d010ab1a9c}\label{namespacesrc_1_1service_aeb636e4930c1fbe30610e2d010ab1a9c}} 
\mbox{\hyperlink{namespacesrc_1_1service_aeb636e4930c1fbe30610e2d010ab1a9c}{classifier}} = \mbox{\hyperlink{classpijoint__vision_1_1ai_1_1models_1_1Model}{Model}}(\textquotesingle{}src/models/last.\+pt\textquotesingle{}, 0.\+70)
\begin{DoxyCompactList}\small\item\em Blok classifier. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{namespacesrc_1_1service_a7463ea6cc6168dcaf8687891d0c29b2c}\label{namespacesrc_1_1service_a7463ea6cc6168dcaf8687891d0c29b2c}} 
\mbox{\hyperlink{namespacesrc_1_1service_a7463ea6cc6168dcaf8687891d0c29b2c}{up\+\_\+classifier}} = \mbox{\hyperlink{classpijoint__vision_1_1ai_1_1models_1_1Model}{Model}}(\textquotesingle{}src/models/up\+\_\+and\+\_\+down.\+pt\textquotesingle{}, 0.\+30)
\begin{DoxyCompactList}\small\item\em Ground classifier. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This file is part of Pi\+Joint. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacesrc_1_1service_a1b10c504335cd811f3ce4fa0c1e8bb3e}\label{namespacesrc_1_1service_a1b10c504335cd811f3ce4fa0c1e8bb3e}} 
\index{src.service@{src.service}!ground\_position@{ground\_position}}
\index{ground\_position@{ground\_position}!src.service@{src.service}}
\doxysubsubsection{\texorpdfstring{ground\_position()}{ground\_position()}}
{\footnotesize\ttfamily def src.\+service.\+ground\+\_\+position (\begin{DoxyParamCaption}\item[{}]{img }\end{DoxyParamCaption})}



Return the position of the block. 


\begin{DoxyItemize}
\item 0 if it is on the side
\item 1 if it is \char`\"{}naturally\char`\"{} on the ground
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em img} & image of the object \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+: int 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{44 \textcolor{keyword}{def }ground\_position(img):}
\DoxyCodeLine{45     \textcolor{stringliteral}{"""!}}
\DoxyCodeLine{46 \textcolor{stringliteral}{    Return the position of the block}}
\DoxyCodeLine{47 \textcolor{stringliteral}{      -\/ 0 if it is on the side}}
\DoxyCodeLine{48 \textcolor{stringliteral}{      -\/ 1 if it is "naturally" on the ground}}
\DoxyCodeLine{49 \textcolor{stringliteral}{}}
\DoxyCodeLine{50 \textcolor{stringliteral}{    @param img: image of the object}}
\DoxyCodeLine{51 \textcolor{stringliteral}{    @return: int}}
\DoxyCodeLine{52 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54     \textcolor{keyword}{def }area(x,y):}
\DoxyCodeLine{55         \textcolor{stringliteral}{"""!}}
\DoxyCodeLine{56 \textcolor{stringliteral}{        Return the area of the polygon defined by the points}}
\DoxyCodeLine{57 \textcolor{stringliteral}{        @param x: list of x coordinates}}
\DoxyCodeLine{58 \textcolor{stringliteral}{        @param y: list of y coordinates}}
\DoxyCodeLine{59 \textcolor{stringliteral}{        @return: float}}
\DoxyCodeLine{60 \textcolor{stringliteral}{        """}}
\DoxyCodeLine{61         \textcolor{keywordflow}{return} float(0.5*np.abs(np.dot(x,np.roll(y,1))-\/np.dot(y,np.roll(x,1))))}
\DoxyCodeLine{62     }
\DoxyCodeLine{63     ob = up\_classifier.detect\_object(img)}
\DoxyCodeLine{64     matches = sorted([}
\DoxyCodeLine{65         (c, area(}
\DoxyCodeLine{66             (box[0], box[2]), (box[1], box[3])}
\DoxyCodeLine{67         ), conf) \textcolor{keywordflow}{for} c,box, conf \textcolor{keywordflow}{in} ob}
\DoxyCodeLine{68     ], reverse=\textcolor{keyword}{True}, key=\textcolor{keyword}{lambda} x: (x[1], x[2]) )}
\DoxyCodeLine{69     \textcolor{keywordflow}{if} len(matches) > 0:}
\DoxyCodeLine{70         \textcolor{keywordflow}{return} matches[0][0]}
\DoxyCodeLine{71     \textcolor{keywordflow}{else}: }
\DoxyCodeLine{72         \textcolor{keywordtype}{None}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacesrc_1_1service_aa68d180e8a321d2d69439263842208a5}\label{namespacesrc_1_1service_aa68d180e8a321d2d69439263842208a5}} 
\index{src.service@{src.service}!pose@{pose}}
\index{pose@{pose}!src.service@{src.service}}
\doxysubsubsection{\texorpdfstring{pose()}{pose()}}
{\footnotesize\ttfamily def src.\+service.\+pose (\begin{DoxyParamCaption}\item[{}]{img,  }\item[{}]{ob\+\_\+c,  }\item[{}]{point\+\_\+cloud,  }\item[{}]{box }\end{DoxyParamCaption})}



Return the pose of the object. 


\begin{DoxyParams}{Parameters}
{\em img} & image of the object \\
\hline
{\em ob\+\_\+c} & class of the object \\
\hline
{\em point\+\_\+cloud} & point cloud of the scene \\
\hline
{\em box} & bounding box of the object \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+: Pose 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{75 \textcolor{keyword}{def }pose(img, ob\_c, point\_cloud, box):}
\DoxyCodeLine{76     \textcolor{stringliteral}{"""!}}
\DoxyCodeLine{77 \textcolor{stringliteral}{    Return the pose of the object}}
\DoxyCodeLine{78 \textcolor{stringliteral}{}}
\DoxyCodeLine{79 \textcolor{stringliteral}{    @param img: image of the object}}
\DoxyCodeLine{80 \textcolor{stringliteral}{    @param ob\_c: class of the object}}
\DoxyCodeLine{81 \textcolor{stringliteral}{    @param point\_cloud: point cloud of the scene}}
\DoxyCodeLine{82 \textcolor{stringliteral}{    @param box: bounding box of the object}}
\DoxyCodeLine{83 \textcolor{stringliteral}{    @return: Pose}}
\DoxyCodeLine{84 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86     x,y,x1,y1  = box}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     cropped = img[int(y):int(y1), int(x):int(x1)]}
\DoxyCodeLine{89     blok = MegaBloks(cropped, (ob\_c, ground\_position(cropped)))}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     (cx, cy) = blok.center}
\DoxyCodeLine{92     (tx, ty) = blok.piolini}
\DoxyCodeLine{93     px,py,pz = pixel2cloud(point\_cloud, cx+x,cy+y)}
\DoxyCodeLine{94     tx,ty,tz = pixel2cloud(point\_cloud, tx+x,ty+y)}
\DoxyCodeLine{95 }
\DoxyCodeLine{96     \textcolor{keywordflow}{return} Pose(}
\DoxyCodeLine{97         Point(*trw(px,py,pz)),Point(*trw(tx,ty,tz)), blok.yaw, blok.ground}
\DoxyCodeLine{98     ), blok.debug\_image}
\DoxyCodeLine{99 }
\DoxyCodeLine{100 }

\end{DoxyCode}
